# Тестовое задание

Этот проект является тестовым заданием для компании Effective mobile на позицию [Junior Node.js-разработчик](https://ai-hunt.ru/vacancies/NODE).

# Задание

Нужно разработать сервис работы с пользователями. Модель пользователя должна
содержать:

* ФИО
* Дату рождения
* Email - уникальное значение
* Пароль
* Роль - либо admin либо user
* Статус пользователя - активный или нет

Должны быть реализованы следующие endpoint:

1. Регистрация пользователя
1. Авторизация пользователя - любой механизм
1. Получение пользователя по ID (Может получить либо админ либо пользователь сам
себя)
1. Получение списка пользователей - только для админа
1. Блокировка пользователя - либо админ либо пользователь сам себя

Важно обратить внимание на организацию структуры проекта, применять лучшие
практики.

Что использовать запрещено:
- NestJS

Что использовать можно:
- Express или koa
- Любую СУБД
- Любую ORM/ODM
- Желательно работу выполнить на Typescript, но JS так же допускается

# Что внутри

```ansi
.
├── deployments
│   └── docker-compose  // docker-compose.yml для развертывания инфраструктуры
├── emtt.rest           // тестовые запросы к сервисам
├── README.md
└── src
    ├── building-blocks // общие инфраструктурные утилиты
    ├── identity        // микросервис авторизации и аутентификации
    └── profile         // микросервис с данными пользователя
```

# Пояснение по решению

В задании было сказано создать модель пользователя с указанными данными. Я решил отделить эту 
модель от пользователей identity, так как в имеющемся контексте пользователи identity отвечают 
за авторизацию и аутентификацию. В то время как пользователи profile имеют свой ограниченный 
контекст и в рамках своего смыслового ядра и должны быть независимы от сервиса авторизации. Поэтому 
профили создаются через асинхронную отправку сообщения и по идеи должны заполняться пользователем 
уже после регистрации. Например, в разделе Настроек.

Так же я сохранил взятые из `boilerplate` проекта инфраструктурные сервисы для того, чтобы создать 
`production ready` приложение.

# Как запускать

## Docker Compose

Используйте следующую команду для запуска `инфраструктуры` с `docker` используя 
[infrastructure.yaml](./deployments/docker-compose/infrastructure.yaml) из корня приложения:

```bash
docker-compose -f ./deployments/docker-compose/infrastructure.yaml up -d
```

## База данных

Создайте базы данных `identity` и `profile` в контейнере `postgres`.

```
psql -U postgers
create database identity;
create database profile;
```

Выполните миграции в каждом микросервисе:

```
cd src/identity
npm run migration:run
cd ../profile
npm run migration:run
```

## Сборка

Чтобы собрать микросервисы, выполните эту команду в корневой директории каждого микросервиса 
где находится `package.json`:

```bash
npm run build
```

## Run

Чтобы запустить микросервисы, выполните эту команду в корневой директории микросервисов
где находится `package.json`:

```bash
npm run dev
```

## Документация APIs

Каждый микросервис имеет `Swagger OpenAPI`. Откройте `/swagger` для просмотра эндпоинтов.

Для тестирования есть файл [emtt.rest](./emtt.rest), который может быть запущен с помощью 
[REST Client](https://github.com/Huachao/vscode-restclient) `VSCode plugin`.
